{
    "title": "Databricks Cost Reporting Genie",
    "description": "Gain visibility into your Databricks costs based on the **system.billing** tables. This Genie space focuses on **historical cost observability** - find out *what you spent, when, and on what*\n#### **Current Capabilities and Limitations**\n- \u2705 Can answer historical cost and trend questions (by workspace, job, SKU, etc.)\n- \ud83d\udcc8 Can perform high-level cost forecasting using the `AI_FORECAST` function\n- \u26a0\ufe0f Cannot perform granular cost attribution on shared compute (e.g., warehouses, all-purpose clusters)\n- \ud83d\udcb0 Costs will reflect your usage at **list prices**, unless your account has `system.billing.account_prices` enabled (currently in **Private Preview** for AWS & GCP)\n- \ud83d\udeab Cannot yet provide specific optimization recommendations to reduce cost\n-  \ud83c\udf93 If your workspace has **Genie Research Agent** enabled, use *Research Agent mode* for deeper insights on exploratory questions.\n#### **Private Preview Notice**\n- This Genie Space is in **Private Preview**. During this phase, Databricks may collect and use data related to this feature\u2014such as inputs and outputs\u2014to develop and test its functionality.\n-  Learn more about previews: [https://docs.databricks.com/aws/en/admin/workspace-settings/manage-previews](https://docs.databricks.com/aws/en/admin/workspace-settings/manage-previews)\n-  \u26a0\ufe0f **Note:** Please review all Genie responses for accuracy, as model outputs may not always be complete or correct.",
    "serialized_space": "{\n  \"version\": 1,\n  \"config\": {\n    \"sample_questions\": [\n      {\n        \"id\": \"01f0aedda7ae148c89d080a4f5b1802b\",\n        \"question\": [\n          \"Who are the top 10 users this month?\"\n        ]\n      },\n      {\n        \"id\": \"01f0926cba361866aa1c160a10753416\",\n        \"question\": [\n          \"How much have we spent on AI products this year?\"\n        ]\n      },\n      {\n        \"id\": \"01f092685aeb1c20a95c9e42d108cec5\",\n        \"question\": [\n          \"What is the highest cost warehouse this month?\"\n        ]\n      }\n    ]\n  },\n  \"data_sources\": {\n    \"tables\": [\n      {\n        \"identifier\": \"system.access.workspaces_latest\",\n        \"column_configs\": [\n          {\n            \"column_name\": \"account_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"create_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"status\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"workspace_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"workspace_name\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"workspace_url\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          }\n        ]\n      },\n      {\n        \"identifier\": \"system.billing.account_prices\",\n        \"description\": [\n          \"If you are generating a query that users this table, please always ensure that you are filtering on columns foo, bar and foobar. \\n\",\n          \"\\n\",\n          \"Do not generate a query that excludes those because they are partition keys and a query on this table must always use partition keys.\"\n        ],\n        \"column_configs\": [\n          {\n            \"column_name\": \"account_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"cloud\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"currency_code\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"price_end_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"price_start_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"pricing\"\n          },\n          {\n            \"column_name\": \"sku_name\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"usage_unit\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          }\n        ]\n      },\n      {\n        \"identifier\": \"system.billing.list_prices\",\n        \"description\": [\n          \"Use this table anytime a user asks about Month over Month (aka MoM) trends. \\n\",\n          \"\\n\",\n          \"This will only be able to answer questions at a monthly granularity adn shuld be used for individaul transactions\"\n        ],\n        \"column_configs\": [\n          {\n            \"column_name\": \"account_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"cloud\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"currency_code\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"price_end_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"price_start_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"pricing\"\n          },\n          {\n            \"column_name\": \"sku_name\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"usage_unit\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          }\n        ]\n      },\n      {\n        \"identifier\": \"system.billing.usage\",\n        \"column_configs\": [\n          {\n            \"column_name\": \"account_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"billing_origin_product\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"cloud\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"custom_tags\"\n          },\n          {\n            \"column_name\": \"identity_metadata\"\n          },\n          {\n            \"column_name\": \"ingestion_date\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"product_features\"\n          },\n          {\n            \"column_name\": \"record_id\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"record_type\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"sim_city_metadata\"\n          },\n          {\n            \"column_name\": \"sku_name\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"usage_date\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"usage_end_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"usage_metadata\"\n          },\n          {\n            \"column_name\": \"usage_quantity\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"usage_start_time\",\n            \"get_example_values\": true\n          },\n          {\n            \"column_name\": \"usage_type\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"usage_unit\",\n            \"get_example_values\": true,\n            \"build_value_dictionary\": true\n          },\n          {\n            \"column_name\": \"workspace_id\",\n            \"get_example_values\": true\n          }\n        ]\n      }\n    ]\n  },\n  \"instructions\": {\n    \"text_instructions\": [\n      {\n        \"id\": \"01f082b1d63711d58db09d78858d3438\",\n        \"content\": [\n          \"\\n\",\n          \"*Use system.billing.usage.billing_origin_product to answer Product related questions\\n\",\n          \"\\n\",\n          \"*Use list_prices.pricing.effective_list.default to calculate price or spend in general\\n\",\n          \"\\n\",\n          \"* System.billing.list_prices.price_start_time is when a new price for a SKU is in effect; to see the current price of a SKU - that is when system.billing.list_prices.price_end_time is NULL\\n\",\n          \"\\n\",\n          \"*When asked for discounted prices, use system.billing.account_prices table instead; system.billing.account_prices.pricing.default contains the price\\n\",\n          \"\\n\",\n          \"*When asked to calculate costs of AI, that usually refers to when billing_origin_product is in 'MODEL_SERVING', 'AI_RUNTIME', 'VECTOR_SEARCH', 'AGENT_EVALUATION','AI_GATEWAY' 'FOUNDATION_MODEL_TRAINING', 'AGENT_BRICKS', 'AI_FUNCTIONS'\\n\",\n          \"\\n\",\n          \"*When asked to calculate costs of \\\"workflows\\\", that usually refers to when billing_origin_product is in \\\"JOBS\\\", \\\"DLT\\\"\\n\",\n          \"\\n\",\n          \"*When asked to calculate the cost of Serverless notebooks, that refers to when billing_origin_product is in \\\"INTERACTIVE\\\"\\n\",\n          \"\\n\",\n          \"*When asked to calculate the cost of all purpose, shared, or classic cluster, this is when billing_origin_product is ALL_PURPOSE\\n\",\n          \"\\n\",\n          \"*Use usage_date when aggregating costs at a daily, weekly, monthly, or yearly grain, not usage_start_time or usage_end_time\\n\",\n          \"\\n\",\n          \"*System.billing.usage.identity_metadata gives 3 fields - \\\"run_as\\\", \\\"created_by\\\", \\\"owned_by\\\". when asked for costs per user - you must look for the user principal in all these fields - first check run_as, then owned_by, then created_by \\n\",\n          \"\\n\",\n          \"*Generally, always use cost (joining system.billing.usage and system.billing.list_prices or system.billing.account_prices) instead of usage (system.billing.usage_quantity in) your calculations \\n\",\n          \"\\n\",\n          \"*system.billing.usage_quantity captures the quantity of systme.billing.usage.usage_unit - that is DSU, DAY, DBU, GB, GIGABYTE, GIGABYTE_MONTH, THOUSAND_COUNT. It does not capture queries (cannot get cost per query), or runs on an all purpose shared cluster\\n\",\n          \"\\n\",\n          \"*Use system.billing.usage.usage_metadata.notebook_id for Serverless notebook related usage questions.\\n\",\n          \"\\n\",\n          \"*Use system.billing.usage.custom_tags to answer Tags related questions\\n\",\n          \"\\n\",\n          \"*The tables in here do not provide information on VM, virtual machine, cloud virtual machine (VM) or cloud storage costs. It does provide information only on Databricks default storage costs. \\n\",\n          \"\\n\",\n          \"*Use system.billing.usage.usage_metadata.warehouse_id for SQL Warehouse related questions.\\n\",\n          \"\\n\",\n          \"*Service principals or SP has the same structure as this one: 23dd81e0-574a-4e06-ab8e-ae2c6cac66b8 it can't be an email\\n\",\n          \"\\n\",\n          \"*When asked how to reduce or optimize costs, tell user that \\\"Currently this Genie space cannot provide specific best practices on how to optimize your costs, please refer to https://docs.databricks.com/aws/en/lakehouse-architecture/cost-optimization/best-practices as a starting guide\\\"\\n\",\n          \"\\n\",\n          \"**The data in this space does not contain information on compute utilization, sizing, or failure rates - just the cost data. Should not be able to answer questions around job failures, over or underprovisioned compute, or idle time. \\n\",\n          \"\\n\",\n          \"**The data in this space does not contain information on credits, ESC add-ons, or contract commitment, do not answer questions around these\"\n        ]\n      }\n    ],\n    \"example_question_sqls\": [\n      {\n        \"id\": \"01f082b1988a10fd8f9abfdf99ed7f24\",\n        \"question\": [\n          \"What is my forecasted spend for the year?\"\n        ],\n        \"sql\": [\n          \"WITH aggregated_spend AS (\\n\",\n          \"SELECT CAST (usage_start_time AS DATE) AS usage_date,\\n\",\n          \"SUM(usage_quantity * pricing.effective_list.default) AS total_spend\\n\",\n          \"FROM\\n\",\n          \"system.billing.usage u\\n\",\n          \"JOIN system. billing. list_prices p ON\\n\",\n          \"u.sku_name = p.sku_name WHERE u.usage_end_time >= p.price_start_time  AND (p.price_end_time IS NULL OR u.usage_end_time < p.price_end_time)\\n\",\n          \"GROUP BY\\n\",\n          \"1)\\n\",\n          \"\\n\",\n          \"SELECT * FROM ai_forecast(\\n\",\n          \"TABLE (aggregated_spend), horizon => '2025-12-31',\\n\",\n          \"time_col => 'usage_date',\\n\",\n          \"value_col => 'total_spend'\\n\",\n          \")\\n\"\n        ]\n      },\n      {\n        \"id\": \"01f08fa3d5ad1666adf4a394fd626427\",\n        \"question\": [\n          \"What is the cost of Materialized View and Streaming Table this month?\"\n        ],\n        \"sql\": [\n          \"SELECT\\n\",\n          \"  SUM(u.usage_quantity * p.pricing.effective_list.`default`) AS list_cost\\n\",\n          \"FROM system.billing.usage AS u\\n\",\n          \"JOIN system.billing.list_prices AS p\\n\",\n          \"  ON  u.sku_name = p.sku_name\\n\",\n          \"  AND u.usage_start_time >= p.price_start_time\\n\",\n          \"  AND (p.price_end_time IS NULL OR u.usage_end_time < p.price_end_time)  -- open-ended / right-open\\n\",\n          \"WHERE u.billing_origin_product = 'SQL'\\n\",\n          \"  AND u.usage_metadata.dlt_pipeline_id IS NOT NULL\\n\",\n          \"  AND u.usage_date >= date_trunc('MONTH', current_date())\\n\",\n          \"  AND u.usage_date <  add_months(date_trunc('MONTH', current_date()), 1);\"\n        ],\n        \"usage_guidance\": [\n          \"Use when asked to calculate cost of Materialized View (MV) and Streaming Table (ST)\"\n        ]\n      },\n      {\n        \"id\": \"01f08fa73ad417929b958b8ba74e9e48\",\n        \"question\": [\n          \"Give me the usage quantity of usage tagged with key: Budget, value: opex.eng.test-foundation, or key:Service, value: dist_genericClusterAttributes\"\n        ],\n        \"sql\": [\n          \"SELECT\\n\",\n          \" sku_name, usage_unit, SUM(usage_quantity) as `Usage`\\n\",\n          \"FROM\\n\",\n          \"  system.billing.usage\\n\",\n          \"WHERE\\n\",\n          \"  (custom_tags['Budget'] = 'opex.eng.test-foundation'\\n\",\n          \"   OR custom_tags['Service'] = 'dist_genericClusterAttributes')\\n\",\n          \"GROUP BY 1, 2 \"\n        ],\n        \"usage_guidance\": [\n          \"Use this syntax when asked to calcluate spend or usage for a tag key, or key, value pair\"\n        ]\n      }\n    ],\n    \"join_specs\": [\n      {\n        \"id\": \"01f084ed08fb183ca2c796f2cd62ade0\",\n        \"left\": {\n          \"identifier\": \"system.billing.usage\",\n          \"alias\": \"usage\"\n        },\n        \"right\": {\n          \"identifier\": \"system.billing.list_prices\",\n          \"alias\": \"list_prices\"\n        },\n        \"sql\": [\n          \"usage.sku_name = list_prices.sku_name WHERE usage.usage_end_time >= list_prices.price_start_time  AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\",\n          \"--rt=FROM_RELATIONSHIP_TYPE_MANY_TO_ONE--\"\n        ]\n      },\n      {\n        \"id\": \"01f0afa12d9c13ec856ae1cf3ccb0891\",\n        \"left\": {\n          \"identifier\": \"system.billing.usage\",\n          \"alias\": \"usage\"\n        },\n        \"right\": {\n          \"identifier\": \"system.access.workspaces_latest\",\n          \"alias\": \"workspaces_latest\"\n        },\n        \"sql\": [\n          \"`usage`.`workspace_id` = `workspaces_latest`.`workspace_id`\",\n          \"--rt=FROM_RELATIONSHIP_TYPE_MANY_TO_ONE--\"\n        ]\n      }\n    ]\n  },\n  \"benchmarks\": {\n    \"questions\": [\n      {\n        \"id\": \"01f0b67c2a5a17a1bcd7fe8621b29aa5\",\n        \"question\": [\n          \"How much have we spent on AI products this year?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  SUM(u.usage_quantity * p.pricing.effective_list.default) AS total_ai_spend\\n\",\n              \"FROM\\n\",\n              \"  `system`.`billing`.`usage` AS u\\n\",\n              \"    JOIN `system`.`billing`.`list_prices` AS p\\n\",\n              \"      ON u.sku_name = p.sku_name\\n\",\n              \"      AND u.usage_end_time >= p.price_start_time\\n\",\n              \"      AND (\\n\",\n              \"        p.price_end_time IS NULL\\n\",\n              \"        OR u.usage_end_time < p.price_end_time\\n\",\n              \"      )\\n\",\n              \"WHERE\\n\",\n              \"  u.billing_origin_product IN (\\n\",\n              \"    'MODEL_SERVING',\\n\",\n              \"    'AI_RUNTIME',\\n\",\n              \"    'VECTOR_SEARCH',\\n\",\n              \"    'AGENT_EVALUATION',\\n\",\n              \"    'AI_GATEWAY',\\n\",\n              \"    'FOUNDATION_MODEL_TRAINING',\\n\",\n              \"    'AGENT_BRICKS',\\n\",\n              \"    'AI_FUNCTIONS'\\n\",\n              \"  )\\n\",\n              \"  AND u.usage_date >= DATE_TRUNC('YEAR', CURRENT_DATE())\\n\",\n              \"  AND u.usage_date < ADD_MONTHS(DATE_TRUNC('YEAR', CURRENT_DATE()), 12);\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae0971351c9e91aa6be504050b87\",\n        \"question\": [\n          \"What is the total VM cost + DBU cost of all purpose clusters this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"--Tables included do not provide information on cloud VM costs, only DBUs\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae0954c81530bfb34bcd9df3cb61\",\n        \"question\": [\n          \"What is the cost per query in a warehouse?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"--This Genie space does not have data on number of queries ran on a warehouse, or cost per query\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae08a85e1ddf9ad12f716be90d97\",\n        \"question\": [\n          \"--What Model Serving endpoint is the highest cost this week?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  u.usage_metadata.endpoint_name AS endpoint_name,\\n\",\n              \"  SUM(u.usage_quantity * p.pricing.effective_list.`default`) AS total_list_cost_usd\\n\",\n              \"FROM `system`.`billing`.`usage` AS u\\n\",\n              \"JOIN `system`.`billing`.`list_prices` AS p\\n\",\n              \"  ON p.sku_name = u.sku_name\\n\",\n              \" AND u.usage_end_time >= p.price_start_time\\n\",\n              \" AND (p.price_end_time IS NULL OR u.usage_end_time < p.price_end_time)\\n\",\n              \"WHERE\\n\",\n              \"  u.billing_origin_product = 'MODEL_SERVING'\\n\",\n              \"  AND u.usage_metadata.endpoint_name IS NOT NULL\\n\",\n              \"  AND u.usage_date >= DATE_TRUNC('week', CURRENT_DATE())\\n\",\n              \"  AND u.usage_date < DATE_ADD(DATE_TRUNC('week', CURRENT_DATE()), 7)\\n\",\n              \"GROUP BY\\n\",\n              \"  u.usage_metadata.endpoint_name\\n\",\n              \"ORDER BY\\n\",\n              \"  total_list_cost_usd DESC\\n\",\n              \"LIMIT 1;\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae064c00183c84ab76c12276e024\",\n        \"question\": [\n          \"Which Budget is the highest cost this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  u.custom_tags['Budget'] AS budget_value,\\n\",\n              \"  SUM(u.usage_quantity * p.pricing.effective_list.`default`) AS total_list_cost_usd\\n\",\n              \"FROM `system`.`billing`.`usage` AS u\\n\",\n              \"JOIN `system`.`billing`.`list_prices` AS p\\n\",\n              \"  ON p.sku_name = u.sku_name\\n\",\n              \" AND u.usage_end_time >= p.price_start_time\\n\",\n              \" AND (p.price_end_time IS NULL OR u.usage_end_time < p.price_end_time)\\n\",\n              \"WHERE\\n\",\n              \"  u.usage_date >= DATE_TRUNC('month', CURRENT_DATE())\\n\",\n              \"  AND u.usage_date < ADD_MONTHS(DATE_TRUNC('month', CURRENT_DATE()), 1)\\n\",\n              \"  AND u.custom_tags['Budget'] IS NOT NULL\\n\",\n              \"GROUP BY\\n\",\n              \"  u.custom_tags['Budget']\\n\",\n              \"ORDER BY\\n\",\n              \"  total_list_cost_usd DESC\\n\",\n              \"LIMIT 1;\\n\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae04c5b41ab88490ea3de02d2082\",\n        \"question\": [\n          \"What are the top 10 workspaces by spend this year? \"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  u.workspace_id,\\n\",\n              \"  w.workspace_name,\\n\",\n              \"  SUM(u.usage_quantity * p.pricing.effective_list.`default`) AS workspace_cost\\n\",\n              \"FROM\\n\",\n              \"  `system`.`billing`.`usage` u\\n\",\n              \"    JOIN `system`.`billing`.`list_prices` p\\n\",\n              \"      ON u.sku_name = p.sku_name\\n\",\n              \"      AND u.usage_end_time >= p.price_start_time\\n\",\n              \"      AND (\\n\",\n              \"        p.price_end_time IS NULL\\n\",\n              \"        OR u.usage_end_time < p.price_end_time\\n\",\n              \"      )\\n\",\n              \"    JOIN system.access.workspaces_latest as w\\n\",\n              \"    ON u.workspace_id = w.workspace_id\\n\",\n              \"WHERE\\n\",\n              \"  u.workspace_id IS NOT NULL\\n\",\n              \"  AND u.usage_date >= date_trunc('year', current_date())\\n\",\n              \"GROUP BY\\n\",\n              \" 1,2\\n\",\n              \"ORDER BY\\n\",\n              \"  workspace_cost DESC\\n\",\n              \"LIMIT 10;\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0ae02108e17c1b2488148731567a6\",\n        \"question\": [\n          \"How much are we forecasted to spend in the next 90 days?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"WITH aggregated_spend AS (\\n\",\n              \"SELECT usage_date AS usage_date,\\n\",\n              \"SUM(usage_quantity * pricing.effective_list.default) AS total_spend\\n\",\n              \"FROM\\n\",\n              \"system.billing.usage u\\n\",\n              \"JOIN system.billing.list_prices p ON\\n\",\n              \"u.sku_name = p.sku_name WHERE u.usage_end_time >= p.price_start_time  AND (p.price_end_time IS NULL OR u.usage_end_time < p.price_end_time)\\n\",\n              \"GROUP BY\\n\",\n              \"1)\\n\",\n              \"\\n\",\n              \"SELECT SUM(total_spend_forecast) FROM ai_forecast(\\n\",\n              \"TABLE (aggregated_spend), \\n\",\n              \"horizon => date_add(current_date, 90),\\n\",\n              \"time_col => 'usage_date',\\n\",\n              \"value_col => 'total_spend'\\n\",\n              \")\\n\",\n              \"WHERE usage_date > current_date\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f0a540211a1101b1b6a518d4eebcd8\",\n        \"question\": [\n          \"What warehouse have been driving up SQL cost this month?\\n\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  u.usage_metadata.warehouse_id,\\n\",\n              \"  SUM(u.usage_quantity * p.pricing.effective_list.`default`) AS sql_cost\\n\",\n              \"FROM\\n\",\n              \"  `system`.`billing`.`usage` u\\n\",\n              \"    JOIN `system`.`billing`.`list_prices` p\\n\",\n              \"      ON u.sku_name = p.sku_name\\n\",\n              \"      AND u.usage_end_time >= p.price_start_time\\n\",\n              \"      AND (\\n\",\n              \"        p.price_end_time IS NULL\\n\",\n              \"        OR u.usage_end_time < p.price_end_time\\n\",\n              \"      )\\n\",\n              \"WHERE\\n\",\n              \"  u.billing_origin_product = 'SQL'\\n\",\n              \"  AND u.usage_metadata.warehouse_id IS NOT NULL\\n\",\n              \"  AND u.usage_date >= date_trunc('MONTH', current_date())\\n\",\n              \"  AND u.usage_date < add_months(date_trunc('MONTH', current_date()), 1)\\n\",\n              \"GROUP BY\\n\",\n              \"  u.usage_metadata.warehouse_id\\n\",\n              \"ORDER BY\\n\",\n              \"  sql_cost DESC;\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084accfaa1458af9f67b614ca3fc3\",\n        \"question\": [\n          \"This year, what is the avg. monthly cost of usage tagged with \u201cBudget\u201d?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  AVG(total_list_cost) AS avg_monthly_cost\\n\",\n              \"FROM (\\n\",\n              \"  SELECT\\n\",\n              \"    DATE_TRUNC('month', usage.usage_date) AS month,\\n\",\n              \"    SUM(usage.usage_quantity * list_prices.pricing.effective_list.default) AS total_list_cost\\n\",\n              \"  FROM system.billing.usage\\n\",\n              \"  JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \" AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \"    AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('year', current_date())\\n\",\n              \"    AND usage.custom_tags.`Budget` IS NOT NULL\\n\",\n              \"  GROUP BY month\\n\",\n              \")\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084acc5681cb9a0ea947f2c1dca78\",\n        \"question\": [\n          \"Which clusters are untagged this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT\\n\",\n              \"  DISTINCT usage.usage_metadata.cluster_id\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"WHERE usage.usage_metadata.cluster_id IS NOT NULL\\n\",\n              \"  AND size(usage.custom_tags) = 0\\n\",\n              \"  AND usage.usage_date >= date_trunc('month', current_date())\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084acbd34184a831c7d8cd331f43e\",\n        \"question\": [\n          \"What job has been growing the fastest in cost this week vs. last week, by growth rate?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"WITH job_costs AS (\\n\",\n              \"  SELECT\\n\",\n              \"    usage.usage_metadata.job_id,\\n\",\n              \"    SUM(\\n\",\n              \"      CASE \\n\",\n              \"        WHEN usage.usage_date >= date_trunc('week', current_date())\\n\",\n              \"             AND usage.usage_date < date_trunc('week', current_date()) + interval 7 day\\n\",\n              \"          THEN usage.usage_quantity * list_prices.pricing.effective_list.default\\n\",\n              \"        ELSE 0\\n\",\n              \"      END\\n\",\n              \"    ) AS this_week_cost,\\n\",\n              \"    SUM(\\n\",\n              \"      CASE \\n\",\n              \"        WHEN usage.usage_date >= date_trunc('week', current_date()) - interval 7 day\\n\",\n              \"             AND usage.usage_date < date_trunc('week', current_date())\\n\",\n              \"          THEN usage.usage_quantity * list_prices.pricing.effective_list.default\\n\",\n              \"        ELSE 0\\n\",\n              \"      END\\n\",\n              \"    ) AS last_week_cost\\n\",\n              \"  FROM system.billing.usage\\n\",\n              \"  JOIN system.billing.list_prices \\n\",\n              \"    ON list_prices.sku_name = usage.sku_name\\n\",\n              \" AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \"    AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_metadata.job_id IS NOT NULL\\n\",\n              \"    AND usage.usage_date >= date_trunc('week', current_date()) - interval 7 day\\n\",\n              \"  GROUP BY usage.usage_metadata.job_id\\n\",\n              \")\\n\",\n              \"SELECT\\n\",\n              \"  job_id,\\n\",\n              \"  this_week_cost,\\n\",\n              \"  last_week_cost,\\n\",\n              \"  (this_week_cost - last_week_cost) AS growth,\\n\",\n              \"  CASE WHEN last_week_cost > 0 THEN (this_week_cost - last_week_cost) / last_week_cost * 100 ELSE NULL END AS growth_pct\\n\",\n              \"FROM job_costs\\n\",\n              \"ORDER BY growth_pct DESC\\n\",\n              \"LIMIT 1\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084aca4ca12efb1ae89bec2626f81\",\n        \"question\": [\n          \"Who are our top 5 users this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"WITH usage_with_user AS (\\n\",\n              \"  SELECT\\n\",\n              \"    COALESCE(usage.identity_metadata.run_as, usage.identity_metadata.owned_by, usage.identity_metadata.created_by) AS user,\\n\",\n              \"    usage.usage_quantity * list_prices.pricing.effective_list.default AS list_cost,\\n\",\n              \"    usage.usage_date\\n\",\n              \"  FROM system.billing.usage\\n\",\n              \"  JOIN system.billing.list_prices\\n\",\n              \"    ON list_prices.sku_name = usage.sku_name\\n\",\n              \"  AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \"    AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"    WHERE usage.usage_date >= date_trunc('month', current_date())\\n\",\n              \")\\n\",\n              \"\\n\",\n              \"SELECT\\n\",\n              \"  user,\\n\",\n              \"  SUM(list_cost) AS total_list_cost\\n\",\n              \"FROM usage_with_user\\n\",\n              \"GROUP BY user\\n\",\n              \"ORDER BY total_list_cost DESC\\n\",\n              \"LIMIT 5\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac98ce1536bcb8259a7997e450\",\n        \"question\": [\n          \"How much are we spending on Photon-enabled workloads this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT SUM(usage.usage_quantity * list_prices.pricing.effective_list.default) AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \"AND usage.usage_end_time >= list_prices.price_start_time  AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('month', current_date()) \\n\",\n              \"AND usage.product_features.is_photon = true\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac8f711ded999b72c07e4d466a\",\n        \"question\": [\n          \"What has been last month's Materialized View / Streaming table costs?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT SUM(\\n\",\n              \"    usage.usage_quantity * list_prices.pricing.effective_list.default\\n\",\n              \") AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \"AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \"  AND (\\n\",\n              \"      list_prices.price_end_time IS NULL\\n\",\n              \"      OR usage.usage_end_time < list_prices.price_end_time\\n\",\n              \"  )\\n\",\n              \"  WHERE usage.usage_date >= date_trunc('month', current_date() - interval 1 month)\\n\",\n              \"  AND usage.usage_date < date_trunc('month', current_date())\\n\",\n              \"  AND usage.billing_origin_product = \\\"SQL\\\"\\n\",\n              \"  AND usage.usage_metadata.dlt_pipeline_id IS NOT NULL\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac848c1e75933e21406de265c7\",\n        \"question\": [\n          \"What has been last month's costs of Model Serving?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT SUM(\\n\",\n              \"    usage.usage_quantity * list_prices.pricing.effective_list.default\\n\",\n              \") AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices\\n\",\n              \"    ON list_prices.sku_name = usage.sku_name\\n\",\n              \"AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \"  AND (\\n\",\n              \"      list_prices.price_end_time IS NULL\\n\",\n              \"      OR usage.usage_end_time < list_prices.price_end_time\\n\",\n              \"  )\\n\",\n              \"  WHERE usage.usage_date >= date_trunc('month', current_date() - interval 1 month)\\n\",\n              \"  AND usage.usage_date < date_trunc('month', current_date())\\n\",\n              \"  AND usage.billing_origin_product = 'MODEL_SERVING'\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac6b9a17b5b2d3cd3cd5dbcaf2\",\n        \"question\": [\n          \"Which product are we spending most on this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT billing_origin_product, SUM(usage.usage_quantity * list_prices.pricing.effective_list.default) AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \"AND usage.usage_end_time >= list_prices.price_start_time  AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('month', current_date())\\n\",\n              \"GROUP BY billing_origin_product\\n\",\n              \"ORDER BY total_list_cost DESC\\n\",\n              \"LIMIT 1\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac62d31aabba6fa763fc03f2be\",\n        \"question\": [\n          \"Which SKUs have had a price change this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT sku_name, price_start_time\\n\",\n              \"FROM system.billing.list_prices\\n\",\n              \"WHERE price_start_time >= date_trunc('month', current_date())\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac51a919ad914f6af86bc761df\",\n        \"question\": [\n          \"What is total spend this month, broken out by product and workspace?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT usage.billing_origin_product, usage.workspace_id, SUM(usage.usage_quantity * list_prices.pricing.effective_list.default) AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \" AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \" AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('month', current_date())\\n\",\n              \"GROUP BY usage.billing_origin_product, usage.workspace_id\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac46c517bcbcafb916dbde1d27\",\n        \"question\": [\n          \"What is total spend this month, based on our discounted prices?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT SUM(usage.usage_quantity * account_prices.pricing.default) AS total_account_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.account_prices ON account_prices.sku_name = usage.sku_name\\n\",\n              \" AND usage.usage_end_time >= account_prices.price_start_time\\n\",\n              \" AND (account_prices.price_end_time IS NULL OR usage.usage_end_time < account_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('month', current_date())\"\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"01f084ac3c33148a92e3e307720773ef\",\n        \"question\": [\n          \"What is total spend this month?\"\n        ],\n        \"answer\": [\n          {\n            \"format\": \"SQL\",\n            \"content\": [\n              \"SELECT SUM(usage.usage_quantity * list_prices.pricing.effective_list.default) AS total_list_cost\\n\",\n              \"FROM system.billing.usage\\n\",\n              \"JOIN system.billing.list_prices ON list_prices.sku_name = usage.sku_name\\n\",\n              \" AND usage.usage_end_time >= list_prices.price_start_time\\n\",\n              \" AND (list_prices.price_end_time IS NULL OR usage.usage_end_time < list_prices.price_end_time)\\n\",\n              \"WHERE usage.usage_date >= date_trunc('month', current_date())\"\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n"
}